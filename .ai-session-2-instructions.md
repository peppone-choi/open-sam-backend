# Session 2: processWar_NG 전투 처리 로직

## 목표
실제 전투 계산 및 수비 순서 결정 로직 구현

## 작업 목록

### 1. src/battle/extractBattleOrder.ts
참고: core/hwe/func.php extractBattleOrder()

수비 순서 결정 요소:
- 병력 수
- 군량 보유량
- 훈련도 (defence_train)
- 능력치 합산

### 2. src/battle/processWarNG.ts
참고: core/hwe/process_war.php processWar_NG()

전투 페이즈:
1. 병종 상성 계산
2. 스킬 발동 (special_war)
3. 피해 계산
4. 사기 체크
5. 로그 기록
6. 승패 판정

### 3. src/battle/BattleSkillSystem.ts
참고: core/hwe/sammo/SpecialityHelper.php

special_war 특기 처리:
- 각 특기별 발동 조건
- 효과 적용
- 로그 메시지

### 4. 테스트: src/battle/__tests__/processWarNG.test.ts
10가지 전투 시나리오:
- 공격자 압승
- 방어자 승리
- 근소한 차이 승리
- 스킬 발동 시나리오
- 군량 부족 시나리오
- etc.

## 검증 기준
- [ ] 수비 순서 === PHP 결과
- [ ] 전투 결과 (승패) === PHP 결과
- [ ] 병력 손실 오차 < 5%
- [ ] 스킬 발동 로직 === PHP

## 완료 시
- coordination/backend-progress.md 업데이트
- d_log/2025-11-23_session-2-battle-logic.log
