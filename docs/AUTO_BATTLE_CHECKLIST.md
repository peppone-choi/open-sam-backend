# 자동전투 시스템 체크리스트

## 📋 테스트 전 준비사항

### 1. 서버 실행 확인
- [ ] MongoDB 실행 중 (`brew services start mongodb-community`)
- [ ] Redis 실행 중 (`brew services start redis`)
- [ ] 백엔드 실행 중 (`cd open-sam-backend && npm run dev`)
- [ ] 프론트엔드 실행 중 (`cd open-sam-front && npm run dev`)

### 2. 게임 상태 확인
- [ ] 게임 세션이 "운영중" 상태인지 확인 (턴 진행 필요)
- [ ] 최소 2개 이상의 적대 국가 존재
- [ ] 장수들이 병사를 보유하고 있는지 확인

---

## 🔍 자동전투 발생 조건 체크

### AI 출병 조건 (SimpleAI.ts)
| 항목 | 조건 | 현재 값 | 충족 여부 |
|------|------|---------|----------|
| 최소 병사 | ≥ 500명 | | [ ] |
| 훈련도 | ≥ 40 | | [ ] |
| 사기 | ≥ 40 | | [ ] |
| 자금 | ≥ 200금 | | [ ] |
| 군량 | ≥ 200쌀 | | [ ] |

### 전투 발생 조건
- [ ] 출병 명령이 예약되어 있는지
- [ ] 적대 국가 도시로 이동 중인지
- [ ] 전투 가능한 상대 장수가 있는지

---

## 📁 관련 파일 목록

### 백엔드 - AI 시스템
| 파일 | 역할 | 확인 사항 |
|------|------|----------|
| `src/core/SimpleAI.ts` | AI 의사결정 | 출병 조건, 징병량 |
| `src/core/event/Action/ProcessIncome.ts` | 봉록 지급 | 봄/가을 지급 |
| `src/services/global/ExecuteEngine.service.ts` | 턴 실행 | 월별 이벤트 호출 |

### 백엔드 - 전투 시스템
| 파일 | 역할 | 확인 사항 |
|------|------|----------|
| `src/services/battle/BattleEngine.service.ts` | 전투 엔진 | 전투 계산 로직 |
| `src/services/battle/BattleResult.service.ts` | 전투 결과 | 결과 저장/조회 |
| `src/commands/general/deploy.ts` | 출병 명령 | 출병 처리 |
| `src/commands/general/conscript.ts` | 징병 명령 | 병종 ID 매핑 |

### 백엔드 - 데이터
| 파일 | 역할 | 확인 사항 |
|------|------|----------|
| `config/scenarios/sangokushi/data/units.json` | 병종 데이터 | ID 1100~1503 |
| `config/scenarios/sangokushi/data/constants.json` | 게임 상수 | 전투 관련 설정 |

### 프론트엔드 - 전투 UI
| 파일 | 역할 | 확인 사항 |
|------|------|----------|
| `src/components/battle/BattleResultLog.tsx` | 전투 결과 로그 | PHP 스타일 표시 |
| `src/components/battle/UnitSprite.tsx` | 유닛 스프라이트 | 병종 ID 매핑 |

---

## 🧪 테스트 시나리오

### 시나리오 1: AI 자동 징병
1. 게임 시작 후 턴 진행
2. 콘솔에서 `[SimpleAI] 징병` 로그 확인
3. 장수 병력이 증가하는지 확인

**예상 로그:**
```
[SimpleAI] 장수 XXX 명령 결정: 징병
[SimpleAI] 도민병 5000명을 징병했습니다.
```

### 시나리오 2: AI 자동 출병
1. 장수가 충분한 병력 보유 (≥500명)
2. 훈련도/사기 충족 (≥40)
3. 적대 국가 인접 도시 존재
4. 콘솔에서 `[SimpleAI] 출병` 로그 확인

**예상 로그:**
```
[SimpleAI] 장수 XXX 명령 결정: 출병
[SimpleAI] XXX -> YYY 도시로 출병
```

### 시나리오 3: 전투 발생
1. 출병한 장수가 적 도시에 도착
2. 전투 발생 및 결과 계산
3. 감찰부에서 전투 기록 확인

**예상 로그:**
```
[BattleEngine] 전투 시작: XXX vs YYY
[BattleEngine] 전투 결과: XXX 승리
```

---

## 🔧 문제 해결 가이드

### 문제 1: AI가 징병하지 않음
**증상:** `[SimpleAI] 징병 불가` 로그
**원인:** 자원 부족 또는 병종 ID 오류
**해결:**
1. 장수의 자금/군량 확인
2. `selectBestCrewType()` 반환값 확인 (1100, 1200, 1201, 1300)

### 문제 2: AI가 출병하지 않음
**증상:** `[SimpleAI] 출병 불가` 로그
**원인:** 병사/훈련도/사기 부족
**해결:**
1. 장수 병력 확인 (≥500명)
2. 훈련도/사기 확인 (≥40)
3. `shouldDeploy()` 로직 확인

### 문제 3: 전투가 발생하지 않음
**증상:** 출병은 하지만 전투 없음
**원인:** 전투 엔진 미호출 또는 조건 미충족
**해결:**
1. 출병 목적지에 적 장수 존재 확인
2. `BattleEngine.service.ts` 호출 여부 확인

### 문제 4: 전투 결과가 표시되지 않음
**증상:** 전투는 발생하지만 UI에 안 보임
**원인:** 프론트엔드 컴포넌트 문제
**해결:**
1. 감찰부 페이지 접속
2. 브라우저 콘솔 에러 확인
3. `BattleResultLog.tsx` 확인

---

## ✅ 최종 확인 체크리스트

### 징병 시스템
- [ ] AI가 정상적으로 징병 명령 실행
- [ ] 유저가 정상적으로 징병 가능
- [ ] 병종 ID가 올바르게 매핑됨 (1100, 1200, 1201, 1300)
- [ ] 징병량이 통솔력에 따라 계산됨

### 출병 시스템
- [ ] AI가 조건 충족 시 출병 명령 실행
- [ ] 유저가 정상적으로 출병 가능
- [ ] 출병 후 이동 처리 정상

### 전투 시스템
- [ ] 전투 발생 시 BattleEngine 호출
- [ ] 전투 결과 계산 정상
- [ ] 전투 로그 저장 정상
- [ ] 감찰부에서 전투 기록 조회 가능

### 봉록 시스템
- [ ] 봄 1월에 금 지급
- [ ] 가을 7월에 쌀 지급
- [ ] 장수별 봉록 계산 정상

---

## 📊 테스트 결과 기록

| 테스트 항목 | 테스트 일시 | 결과 | 비고 |
|------------|------------|------|------|
| AI 징병 | | | |
| 유저 징병 | | | |
| AI 출병 | | | |
| 전투 발생 | | | |
| 전투 결과 표시 | | | |
| 봉록 지급 | | | |

---

## 🚀 다음 단계

자동전투 테스트 완료 후:
1. [ ] 전투 밸런스 조정
2. [ ] 전투 애니메이션 추가 (선택)
3. [ ] 전투 보고서 상세화
4. [ ] 특수 스킬/전법 구현




