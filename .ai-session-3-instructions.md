# Session 3: ConquerCity 도시 점령 & 후처리

## 목표
도시 점령 처리 및 전투 후처리 시스템 구현

## 작업 목록

### 1. src/battle/ConquerCity.ts
참고: core/hwe/func.php ConquerCity()

점령 처리:
- 도시 소유권 변경
- 수비군 포로/해산 처리
- 주민 신뢰도 계산
- 장수 이동 처리

### 2. src/battle/PostBattleProcessor.ts
전투 후처리:
- 기술력 증가
- 외교 관계 업데이트
- 군량 소모 처리
- 경험치/공헌도 분배

### 3. src/services/diplomacy/UpdateRelation.service.ts
참고: core/hwe/func.php 외교 관련 함수

- 전투 사망자 수 기록
- 외교 관계 포인트 조정
- 동맹/적대 관계 업데이트

### 4. 테스트: src/battle/__tests__/ConquerCity.test.ts
5가지 점령 시나리오:
- 정상 점령
- 수도 점령 (국가 멸망)
- 포로 처리
- 주민 신뢰도 변화
- 외교 관계 변화

## 검증 기준
- [ ] 도시 소유권 변경 === PHP
- [ ] 주민/신뢰도 변화 === PHP (오차 <2%)
- [ ] 외교 관계 업데이트 === PHP

## 완료 시
- coordination/backend-progress.md 업데이트
- d_log/2025-11-23_session-3-conquer-city.log
