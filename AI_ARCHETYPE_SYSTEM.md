# NPC AI 역사적 인물 타입 시스템

## 개요

SimpleAI에 **31가지 역사적 인물 기반 장수 타입**을 구현하여 NPC의 행동이 더욱 현실감 있고 다양해졌습니다.

## 구현 내용

### 1. 장수 타입 (31가지)

#### S급 (4-5개 능력 80+)
- **천하패자** (조조형): 모든 것을 잘함, 기회주의적
- **천하명군** (유비형): 인재 등용, 덕치 중시
- **천하명장** (관우/조운형): 전투 특화, 충성심

#### A급 (3개 능력 80+)
- **제왕** (손권형): 균형잡힌 통치
- **대도독** (주유/육손형): 전략적 사고, 대규모 작전
- **오호장군** (관장조마황형): 선봉 돌격, 무력 중시
- **왕좌모사** (제갈량/사마의형): 장기 전략, 기술 발전
- **귀모책사** (곽가/가후형): 계략 특화, 전투 회피

#### B급 (2개 능력 80+)
- **용맹맹장** (여포형): 무조건 싸움, 일기토
- **백전맹장** (서황/장합형): 안정적 전투
- **문무겸장** (조인형): 지략 활용한 전투
- **명신모사** (순욱/진군형): 내정+계략
- **충신맹장** (전위/고순형): 방어, 충성
- **약탈맹장** (문추/안량형): 급습, 약탈
- **경세대신** (순욱/장소형): 국가 운영

#### C급 (1개 특화)
- **순수무인** (전위/허저형): 일기토만
- **순수모사** (서서/법정형): 계략만
- **순수내정** (장굉/비의형): 내정만
- **인기스타** (초선형): 등용, 외교

#### 특수 타입
- **노장** (황충형)
- **암군** (동탁형)
- **모반자** (여포/맹달형)
- **환관** (황호형)
- **의사** (조운형)
- **명사** (관녕형)
- **호걸** (허저형)
- **검객** (왕월형)
- **공성전문** (조인형)
- **기병대장** (마초형)
- **수군대독** (주유형)
- **도적출신** (장연형)
- **평범** (기본형)

### 2. 타입별 행동 특성

각 타입은 다음과 같은 특성을 가집니다:

#### 가중치 모디파이어
```typescript
{
  offensive: 1.0,    // 공격 명령 (출병, 급습)
  defensive: 1.0,    // 방어 명령 (수비강화, 성벽보수)
  domestic: 1.0,     // 내정 명령 (농지개간, 상업투자)
  military: 1.0,     // 군사 명령 (징병, 훈련)
  strategy: 1.0,     // 계략 명령 (기술연구, 계략)
  training: 1.0,     // 자기계발 (단련, 견문)
  trade: 1.0,        // 거래 명령
  diplomacy: 1.0,    // 외교 명령
}
```

**예시: 여포형 (용맹맹장)**
- offensive: 3.0 (출병 확률 3배)
- defensive: 0.5 (방어 확률 절반)
- domestic: 0.2 (내정 거의 안 함)
- strategy: 0.2 (계략 거의 안 함)

**예시: 제갈량형 (왕좌모사)**
- offensive: 1.2 (출병 약간 선호)
- strategy: 2.5 (기술연구/계략 2.5배)
- domestic: 1.5 (내정 우선)

#### 우선 커맨드
각 타입은 선호하는 명령 리스트를 가지며, 이 명령들은 가중치가 1.5배 증가합니다.

**예시:**
- 조조형: ['출병', '기술연구', '상업투자', '선전포고']
- 유비형: ['주민선정', '정착장려', '포상', '등용']
- 여포형: ['출병', '단련', '훈련', '급습']
- 제갈량형: ['기술연구', '출병', '계략', '상업투자']

### 3. 추가 조정 시스템

#### 특기 기반 보너스
장수의 특기(special, special2)에 따라 특정 명령의 가중치가 증가합니다.

```typescript
특기 '신속': 출병 1.5배, 강행 2.0배, 급습 1.8배
특기 '맹공': 출병 2.0배, 훈련 1.5배
특기 '철벽': 수비강화 1.8배, 성벽보수 1.5배
특기 '명정': 주민선정 2.0배, 정착장려 1.5배
특기 '상술': 상업투자 1.8배, 군량매매 1.5배
```

#### 성격 기반 조정
장수의 성격(personal 필드)에 따라 행동이 달라집니다.

```typescript
1: 맹장형 - offensive 2.0배, defensive 0.5배, domestic 0.3배
2: 수비형 - defensive 2.0배, offensive 0.5배
3: 균형형 - 모든 가중치 1.0배 (기본)
4: 모사형 - domestic 1.5배, training 1.5배
5: 충신형 - defensive 1.2배, domestic 1.3배
6: 야심가형 - offensive 1.5배, domestic 1.2배
```

#### 상황 기반 조정
- **전쟁 중**: 군사 명령 2배, 내정 명령 0.3배
- **자원 부족**: 내정 명령 2배, 군사 명령 0.2배

### 4. 명령 결정 프로세스

```
1. 기본 명령 후보 생성
   ↓
2. 타입별 가중치 조정 (역사적 인물)
   ↓
3. 우선 커맨드 가중치 증가 (1.5배)
   ↓
4. 특기 기반 보너스 적용
   ↓
5. 성격 기반 조정
   ↓
6. 전쟁 상황 조정
   ↓
7. 자원 부족 조정
   ↓
8. 실행 가능한 명령 필터링
   ↓
9. 가중치 기반 확률 선택
```

## 사용 예시

```typescript
// NPC 생성 시 자동으로 타입 분류
const ai = new SimpleAI(general, city, nation, env);

// 타입 확인
console.log(ai.getArchetype()); // "천하패자", "용맹맹장" 등

// 명령 결정
const decision = await ai.decideNextCommand();
// decision: { command: '출병', args: {...}, weight: 45.2, reason: '전쟁 중, 출병 가능' }
```

## 로그 예시

```
[SimpleAI] 장수 조조(1) - 타입: 천하패자
[SimpleAI] 선택된 명령: 출병 (가중치: 45.20, 이유: 전쟁 중, 출병 가능)

[SimpleAI] 장수 여포(5) - 타입: 용맹맹장
[SimpleAI] 선택된 명령: 단련 (가중치: 30.00, 이유: 능력치 향상 필요 (평균:65.3))

[SimpleAI] 장수 제갈량(3) - 타입: 왕좌모사
[SimpleAI] 선택된 명령: 기술연구 (가중치: 87.50, 이유: 기술 발전 필요)
```

## 파일 위치

- **구현**: `src/core/SimpleAI.ts`
- **사용**: `src/services/ai/NPCAutoCommand.service.ts`
- **문서**: 
  - `GENERAL_TYPES_HISTORICAL.md` - 31가지 타입 상세 정의
  - `PERSONALITY_EXPANSION.md` - 성격 시스템 확장 가이드

## 향후 개선 방향

1. **학습 시스템**: 성공/실패 경험 기반 가중치 조정
2. **관계 기반 행동**: 상성, 의리, 야망에 따른 배신/충성
3. **장기 기억**: 과거 행동 패턴 저장 및 활용
4. **동적 성격 변화**: 경험에 따른 성격 변화
5. **집단 행동**: 같은 국가 장수들 간의 협력 전략

## 참고

- PHP 원본: `sammo-php/hwe/sammo/General/GeneralAI.php`
- 삼국지 능력치 데이터: 나무위키 삼국지 시리즈
